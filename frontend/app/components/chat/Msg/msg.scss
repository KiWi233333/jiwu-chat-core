// @unocss-include
.msg {
  --at-apply: "w-full max-w-full flex gap-2 px-2 py-3 leading-1.4em";
  transition: background-color 0.2s;
  .body {
    --at-apply: "flex-1 max-w-4/5 sm:max-w-full lg:max-w-30em";
  }
  // 头像
  .avatar {
    --at-apply: "h-2.4rem w-2.4rem flex-shrink-0 rounded-1/2 object-cover border-default";
  }
  .nickname {
    vertical-align: bottom;
  }
  .sendTime {
    transition: none;
  }
  &:hover {
    .sendTime {
      opacity: 0.6;
    }
    // 表情反应工具栏：纯 CSS 显隐，无 JS 监听
    :deep(.reaction-toolbar) {
      --at-apply: "op-100 pointer-events-auto";
    }
  }
  .ai-reply-msg-box,
  .msg-box {
    --at-apply: "overflow-x-hidden active:op-90 transition-opacity text-0.9rem max-w-full w-0 px-3 py-2 leading-1.5em bg-color shadow-sm transition-shadow hover:shadow w-fit";
    border-radius: 6px 1rem 1rem 1rem;
  }
  .msg-wrap {
    word-break: break-all;
    white-space: pre-wrap;
  }

  // 回复
  .reply {
    --at-apply: "text-0.7rem cursor-pointer w-fit flex-row-c-c line-height-none py-1 rounded-sm max-w-full truncate pl-1 pr-2  bg-color hover:shadow-sm transition-shadow";
  }
  // 翻译
  .translation {
    --at-apply: "text-0.8rem w-fit card-rounded-df py-2 px-3 inline-block card-bg-color dark:text-light-900";
  }
  // 问答
  .ask-ai {
    --at-apply: "w-fit flex cursor-pointer items-center truncate p-1 pr-1.5 text-xs card-default";
  }
  // 通知
  .notice-all {
    --at-apply: "max-w-full text-0.7rem w-fit  truncate flex-ml-a w-fit cursor-pointer truncate px-2 text-[--el-color-warning] card-default";
  }
  // @用户
  .at-list {
    --at-apply: "max-w-full text-0.7rem w-fit  truncate flex-ml-a w-fit cursor-pointer truncate px-2 text-color-info card-default";
  }
  // url解析
  .url-info {
    --at-apply: "";
  }
  .flex-mr-a {
    margin-left: auto;
  }

  // 子元素 @ 和 url
  :deep(.at-user) {
    --at-apply: "text-theme-primary dark:text-theme-info font-500 cursor-pointer";
  }
  :deep(.msg-link) {
    --at-apply: "inline hover:underline text-theme-primary dark:text-theme-info";

    &::before {
      content: "";
      --at-apply: "mr-1 p-1.8 cursor-pointer select-none i-solar:link-line-duotone";
    }
  }

  .url-group {
    --at-apply: "flex flex-col gap-1.5 w-fit";

    .url-info {
      --at-apply: "max-w-60vw w-16rem rounded-2 bg-color shadow-sm transition-200 sm:(max-w-16rem min-w-12rem) hover:(shadow)";
    }
    &.multiple-url {
      .url-info {
        --at-apply: "hidden";
      }
      .url-info:nth-child(1) {
        --at-apply: "block mb-2 relative shadow-sm";
        &::after {
          content: "";
          --at-apply: "absolute top-0 left-0 w-full scale-94 mx-a translate-y-2 -z-1 h-full rounded-2 bg-color shadow-sm !bg-op-60";
        }

        &::before {
          content: "";
          --at-apply: "absolute top-0 left-0 w-full scale-90 mx-a translate-y-4 -z-1 h-full rounded-2 bg-color shadow-sm !bg-op-40";
        }
      }
    }
  }
}
// 系统
.notice {
  --at-apply: "p-3 hover:(shadow-md) inline-block  cursor-pointer transition-all !bg-color";
}
// .self .notice {
//   .popper {
//     --at-apply: "bg-theme-primary dark:bg-theme-primary text-white";
//   }
// }
// 回复 - 闪动
.reply-shaing {
  --at-apply: " rounded w-full bg-[var(--el-color-primary-light-7)] op-100 transition-120 ";
}

.body {
  --at-apply: "flex flex-col gap-2 flex-1 min-w-0";
}
.flex-res {
  display: flex;
  gap: 0.5rem;
}
.self {
  ::selection {
    background-color: #f0f0f0 !important;
    color: #010101 !important;
  }
  &.msg {
    --at-apply: "px-2 py-3";
  }
  .body {
    align-items: end;
  }
  padding-left: 4em;
  margin-left: auto;
  .file,
  .flex-res {
    flex-direction: row-reverse;
  }
  .nickname {
    margin-left: auto;
    vertical-align: bottom;
  }
  .flex,
  .flex-ml-a {
    margin-left: auto;
    // align-items: end;
  }
  .flex-mr-a {
    margin-right: auto;
  }
  flex-direction: row-reverse;
  .flex-row {
    margin-left: auto;
    flex-direction: row-reverse;
  }
  .msg-box,
  .self-child {
    margin-left: auto;
    border-radius: 1rem 4px 1rem 1rem;
    --at-apply: "bg-theme-primary dark:bg-theme-primary text-white";
  }
  .flex-col {
    justify-content: right;
  }

  // 子元素 @ 和 url
  :deep(.at-user) {
    --at-apply: "text-white op-100 font-500 transition-opacity cursor-pointer";
  }
  :deep(.msg-link) {
    --at-apply: "underline !text-white transition-colors";
  }
}
