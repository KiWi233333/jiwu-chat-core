<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JiwuChat â€” éƒ¨ç½²é…ç½®å™¨</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Instrument+Sans:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet" />
  <style>
    /* â”€â”€â”€ Design tokens â”€â”€â”€ */
    :root {
      --bg: #f9f9f8;
      --surface: #ffffff;
      --surface-2: #f4f4f3;
      --border: #e4e4e2;
      --border-strong: #c4c4c0;
      --fg: #1a1a18;
      --fg-muted: #6b6b68;
      --fg-subtle: #9b9b98;
      --accent: #1a1a18;
      --accent-fg: #ffffff;
      --accent-hover: #2d2d2a;
      --success: #166534;
      --success-bg: #f0fdf4;
      --warning: #92400e;
      --warning-bg: #fffbeb;
      --code-bg: #f4f4f3;
      --code-fg: #1a1a18;
      --code-var: #0369a1;
      --code-val: #166534;
      --code-comment: #9b9b98;
      --radius: 6px;
      --radius-lg: 10px;
      --shadow-sm: 0 1px 2px rgba(0,0,0,.06);
      --shadow: 0 2px 8px rgba(0,0,0,.08);
      --font-sans: 'Instrument Sans', -apple-system, system-ui, sans-serif;
      --font-mono: 'IBM Plex Mono', 'Menlo', monospace;
    }

    /* â”€â”€â”€ Reset â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--fg);
      font-size: 14px;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    a { color: inherit; text-decoration: none; }

    /* â”€â”€â”€ Layout â”€â”€â”€ */
    .layout {
      display: grid;
      grid-template-columns: 1fr 420px;
      grid-template-rows: auto 1fr;
      min-height: 100vh;
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 24px;
      gap: 0 40px;
    }
    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; padding: 0 16px; }
      .preview-col { display: none; }
    }

    /* â”€â”€â”€ Header â”€â”€â”€ */
    header {
      grid-column: 1 / -1;
      padding: 40px 0 32px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 40px;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 24px;
    }
    .header-left {}
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .logo-icon {
      width: 28px; height: 28px;
      background: var(--accent);
      border-radius: 7px;
      display: flex; align-items: center; justify-content: center;
      color: #fff;
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 500;
      letter-spacing: -.5px;
      flex-shrink: 0;
    }
    .logo-name {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: -.3px;
    }
    header h1 {
      font-size: 13px;
      font-weight: 400;
      color: var(--fg-muted);
      letter-spacing: 0;
    }
    .header-links {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }
    .link-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 13px;
      color: var(--fg-muted);
      background: var(--surface);
      cursor: pointer;
      transition: border-color .15s, color .15s;
    }
    .link-btn:hover { border-color: var(--border-strong); color: var(--fg); }
    .link-btn svg { flex-shrink: 0; }

    /* â”€â”€â”€ Form column â”€â”€â”€ */
    .form-col { grid-column: 1; padding-bottom: 80px; }

    /* â”€â”€â”€ Section card â”€â”€â”€ */
    .section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      margin-bottom: 16px;
      overflow: hidden;
    }
    .section-header {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      transition: background .12s;
    }
    .section-header:hover { background: var(--surface-2); }
    .section-header.no-toggle { cursor: default; }
    .section-header.no-toggle:hover { background: var(--surface); }
    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-icon {
      width: 30px; height: 30px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      display: flex; align-items: center; justify-content: center;
      font-size: 15px;
      flex-shrink: 0;
    }
    .section-label {
      font-weight: 500;
      font-size: 14px;
      letter-spacing: -.2px;
    }
    .section-desc {
      font-size: 12px;
      color: var(--fg-muted);
      margin-top: 1px;
    }
    .section-badge {
      font-family: var(--font-mono);
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 4px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      color: var(--fg-muted);
    }
    .section-badge.optional { color: var(--fg-subtle); }
    .chevron {
      transition: transform .2s;
      color: var(--fg-subtle);
    }
    .chevron.open { transform: rotate(180deg); }
    .section-body {
      padding: 0 20px 20px;
      display: grid;
      gap: 14px;
    }
    .section-body.collapsed { display: none; }
    .section-divider {
      height: 1px;
      background: var(--border);
      margin: 0 0 4px;
    }

    /* â”€â”€â”€ Mode selector â”€â”€â”€ */
    .mode-selector {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .mode-card {
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 16px;
      cursor: pointer;
      transition: border-color .15s, background .15s;
      position: relative;
    }
    .mode-card:hover { border-color: var(--border-strong); }
    .mode-card.active {
      border-color: var(--accent);
      background: color-mix(in srgb, var(--accent) 4%, white);
    }
    .mode-card input[type=radio] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
    .mode-check {
      width: 16px; height: 16px;
      border: 1.5px solid var(--border);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 8px;
      transition: border-color .15s, background .15s;
    }
    .mode-card.active .mode-check {
      border-color: var(--accent);
      background: var(--accent);
    }
    .mode-check-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: white;
      opacity: 0;
      transition: opacity .15s;
    }
    .mode-card.active .mode-check-dot { opacity: 1; }
    .mode-card-title { font-weight: 500; font-size: 13px; margin-bottom: 3px; }
    .mode-card-desc { font-size: 12px; color: var(--fg-muted); line-height: 1.5; }

    /* â”€â”€â”€ Field â”€â”€â”€ */
    .field { display: flex; flex-direction: column; gap: 6px; }
    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    label {
      font-size: 12.5px;
      font-weight: 500;
      color: var(--fg);
      letter-spacing: -.1px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    label .opt-tag {
      font-size: 10px;
      font-weight: 400;
      color: var(--fg-subtle);
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 0 5px;
      letter-spacing: 0;
    }
    .field-hint {
      font-size: 11.5px;
      color: var(--fg-muted);
      margin-top: -3px;
    }
    input[type=text], input[type=number], input[type=password], select {
      width: 100%;
      height: 36px;
      padding: 0 10px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--surface);
      color: var(--fg);
      font-family: var(--font-sans);
      font-size: 13px;
      outline: none;
      transition: border-color .15s, box-shadow .15s;
      appearance: none;
    }
    input[type=text]:focus, input[type=number]:focus, input[type=password]:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 10%, transparent);
    }
    input[type=text]::placeholder, input[type=number]::placeholder { color: var(--fg-subtle); }
    input.monospace {
      font-family: var(--font-mono);
      font-size: 12.5px;
    }
    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b6b68' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 32px;
      cursor: pointer;
    }

    /* â”€â”€â”€ Preview column â”€â”€â”€ */
    .preview-col {
      grid-column: 2;
      padding-top: 0;
      padding-bottom: 80px;
    }
    .preview-sticky {
      position: sticky;
      top: 32px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: calc(100vh - 64px);
    }
    .preview-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .preview-card-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface);
      flex-shrink: 0;
    }
    .preview-card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12.5px;
      font-weight: 500;
      color: var(--fg-muted);
    }
    .preview-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--success);
      flex-shrink: 0;
    }
    .copy-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 11.5px;
      font-family: var(--font-sans);
      background: var(--surface);
      color: var(--fg-muted);
      cursor: pointer;
      transition: all .15s;
    }
    .copy-btn:hover { border-color: var(--border-strong); color: var(--fg); background: var(--surface-2); }
    .copy-btn.copied { border-color: #86efac; background: var(--success-bg); color: var(--success); }
    .code-scroll {
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }
    pre {
      padding: 16px;
      font-family: var(--font-mono);
      font-size: 12px;
      line-height: 1.75;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .env-preview { max-height: 380px; }
    .cmd-preview { max-height: 160px; }
    /* Syntax highlight */
    .tk-comment { color: var(--fg-subtle); font-style: italic; }
    .tk-key { color: #0369a1; }
    .tk-eq { color: var(--fg-subtle); }
    .tk-val { color: #166534; }
    .tk-empty { color: var(--fg-subtle); }
    .tk-section { color: var(--fg-muted); font-style: italic; }
    .tk-cmd { color: #0369a1; }
    .tk-flag { color: var(--warning); }

    /* â”€â”€â”€ Footer note â”€â”€â”€ */
    .info-note {
      background: var(--warning-bg);
      border: 1px solid #fde68a;
      border-radius: var(--radius);
      padding: 10px 14px;
      font-size: 12.5px;
      color: var(--warning);
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }
    .info-note svg { flex-shrink: 0; margin-top: 1px; }

    .step-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .step-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      font-size: 12.5px;
      color: var(--fg-muted);
    }
    .step-num {
      width: 20px; height: 20px;
      border-radius: 50%;
      background: var(--surface-2);
      border: 1px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-family: var(--font-mono);
      font-size: 10px;
      font-weight: 500;
      flex-shrink: 0;
      color: var(--fg);
    }
    .step-item code {
      font-family: var(--font-mono);
      font-size: 11.5px;
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 1px 5px;
      color: var(--fg);
    }

    /* Separator */
    .or-divider {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--fg-subtle);
    }
    .or-divider::before, .or-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* Inline cmd block */
    .cmd-inline {
      font-family: var(--font-mono);
      font-size: 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 10px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      white-space: pre;
      overflow-x: auto;
      color: var(--code-var);
    }
    .cmd-inline .copy-btn { flex-shrink: 0; }

    /* Mobile bottom panel */
    .mobile-preview {
      display: none;
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: var(--surface);
      border-top: 1px solid var(--border);
      z-index: 100;
      padding: 12px 16px;
    }
    @media (max-width: 900px) {
      .mobile-preview { display: block; }
    }
    .mobile-toggle {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 8px 12px;
      font-family: var(--font-sans);
      font-size: 13px;
      cursor: pointer;
      color: var(--fg);
    }
    .mobile-sheet {
      display: none;
      max-height: 70vh;
      overflow-y: auto;
      margin-top: 12px;
    }
    .mobile-sheet.open { display: block; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 999px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--border-strong); }
  </style>
</head>
<body>

<div class="layout">

  <!-- â”€â”€ Header â”€â”€ -->
  <header>
    <div class="header-left">
      <div class="logo">
        <div class="logo-icon">JW</div>
        <span class="logo-name">JiwuChat</span>
      </div>
      <h1>Docker éƒ¨ç½²é…ç½®ç”Ÿæˆå™¨ Â· å¡«å†™å‚æ•°ï¼Œä¸€é”®å¤åˆ¶å¯åŠ¨å‘½ä»¤</h1>
    </div>
    <div class="header-links">
      <a href="https://github.com/KiWi233333/jiwu-chat-core" target="_blank" class="link-btn">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844a9.59 9.59 0 012.504.337c1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.749 0 .268.18.58.688.482A10.019 10.019 0 0022 12c0-5.523-4.477-10-10-10z"/></svg>
        GitHub
      </a>
      <a href="https://github.com/KiWi233333/jiwu-chat-core/blob/main/CONFIG.md" target="_blank" class="link-btn">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        CONFIG.md
      </a>
    </div>
  </header>

  <!-- â”€â”€ Form column â”€â”€ -->
  <div class="form-col">

    <!-- 1. Deploy Mode -->
    <div class="section">
      <div class="section-header no-toggle">
        <div class="section-title">
          <div class="section-icon">ğŸš€</div>
          <div>
            <div class="section-label">éƒ¨ç½²æ–¹å¼</div>
            <div class="section-desc">é€‰æ‹©å¦‚ä½•è·å–åº”ç”¨é•œåƒ</div>
          </div>
        </div>
        <span class="section-badge">å¿…å¡«</span>
      </div>
      <div class="section-body">
        <div class="section-divider"></div>
        <div class="mode-selector">
          <label class="mode-card active" id="mode-image-card" onclick="setMode('image')">
            <input type="radio" name="deploy_mode" value="image" checked />
            <div class="mode-check"><div class="mode-check-dot"></div></div>
            <div class="mode-card-title">é•œåƒéƒ¨ç½²</div>
            <div class="mode-card-desc">ç›´æ¥æ‹‰å–é¢„æ„å»ºé•œåƒï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒå¿«é€Ÿéƒ¨ç½²</div>
          </label>
          <label class="mode-card" id="mode-build-card" onclick="setMode('build')">
            <input type="radio" name="deploy_mode" value="build" />
            <div class="mode-check"><div class="mode-check-dot"></div></div>
            <div class="mode-card-title">æºç æ„å»º</div>
            <div class="mode-card-desc">æœ¬åœ°æ„å»º Docker é•œåƒï¼Œé€‚åˆè‡ªå®šä¹‰å‰ç«¯ API åœ°å€</div>
          </label>
        </div>
      </div>
    </div>

    <!-- 2. Basic -->
    <div class="section">
      <div class="section-header no-toggle">
        <div class="section-title">
          <div class="section-icon">âš™ï¸</div>
          <div>
            <div class="section-label">åŸºç¡€é…ç½®</div>
            <div class="section-desc">é•œåƒç‰ˆæœ¬ã€ç«¯å£ä¸ Docker é•œåƒåŠ é€Ÿ</div>
          </div>
        </div>
        <span class="section-badge">å¿…å¡«</span>
      </div>
      <div class="section-body">
        <div class="section-divider"></div>

        <!-- Image mode fields -->
        <div id="field-image-block">
          <div class="field">
            <label for="JIWU_CHAT_IMAGE">é•œåƒåœ°å€</label>
            <input type="text" id="JIWU_CHAT_IMAGE" class="monospace"
              value="ghcr.io/KiWi233333/jiwu-chat:latest"
              placeholder="ghcr.io/KiWi233333/jiwu-chat:latest"
              oninput="update()" />
            <p class="field-hint">å®Œæ•´é•œåƒåç§°ï¼Œå¯æŒ‡å®šç‰ˆæœ¬ tagï¼Œå¦‚ <code style="font-family:var(--font-mono);font-size:11px;background:var(--code-bg);border:1px solid var(--border);border-radius:3px;padding:0 4px">:v1.8.2</code></p>
          </div>
        </div>

        <!-- Build mode fields -->
        <div id="field-vite-block" style="display:none; display: contents;">
          <div class="field" id="field-vite-api">
            <label for="VITE_API_BASE_URL">åç«¯ API åœ°å€ <span class="opt-tag">æ„å»ºæ—¶æ³¨å…¥</span></label>
            <input type="text" id="VITE_API_BASE_URL" class="monospace"
              value="http://localhost:9090/"
              placeholder="http://your-domain.com:9090/"
              oninput="update()" />
            <p class="field-hint">ç”¨æˆ·è®¿é—®çš„çœŸå®åŸŸåæˆ– IPï¼Œè‹¥æœ‰ Nginx åä»£è¯·å¡«å†™åä»£åçš„åœ°å€</p>
          </div>
          <div class="field" id="field-vite-ws">
            <label for="VITE_API_WS_BASE_URL">WebSocket åœ°å€ <span class="opt-tag">æ„å»ºæ—¶æ³¨å…¥</span></label>
            <input type="text" id="VITE_API_WS_BASE_URL" class="monospace"
              value="ws://localhost:9091/ws"
              placeholder="ws://your-domain.com:9091/ws"
              oninput="update()" />
          </div>
          <div class="field" id="field-vite-oss">
            <label for="VITE_BASE_OSS_PATH">OSS CDN åœ°å€ <span class="opt-tag">å¯é€‰</span></label>
            <input type="text" id="VITE_BASE_OSS_PATH" class="monospace"
              value=""
              placeholder="https://oss.example.com/"
              oninput="update()" />
            <p class="field-hint">ä¸ƒç‰› / å…¶ä»– CDN é™æ€èµ„æºå‰ç¼€ï¼Œä¸å¡«åˆ™ä½¿ç”¨æœ¬åœ°å­˜å‚¨</p>
          </div>
        </div>

        <div class="field-row">
          <div class="field">
            <label for="WEB_PORT">å‰ç«¯ç«¯å£</label>
            <input type="number" id="WEB_PORT" value="3000" min="1" max="65535" oninput="update()" />
          </div>
          <div class="field">
            <label for="API_HTTP_PORT">API HTTP ç«¯å£</label>
            <input type="number" id="API_HTTP_PORT" value="9090" min="1" max="65535" oninput="update()" />
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="API_WS_PORT">WebSocket ç«¯å£</label>
            <input type="number" id="API_WS_PORT" value="9091" min="1" max="65535" oninput="update()" />
          </div>
          <div class="field">
            <label for="DOCKER_REGISTRY">Docker é•œåƒåŠ é€Ÿ <span class="opt-tag">å¯é€‰</span></label>
            <input type="text" id="DOCKER_REGISTRY" class="monospace"
              value="docker.1ms.run"
              placeholder="ç•™ç©ºåˆ™ç›´è¿ Docker Hub"
              oninput="update()" />
          </div>
        </div>
      </div>
    </div>

    <!-- 3. Middleware -->
    <div class="section">
      <div class="section-header no-toggle">
        <div class="section-title">
          <div class="section-icon">ğŸ—„ï¸</div>
          <div>
            <div class="section-label">ä¸­é—´ä»¶è´¦å·</div>
            <div class="section-desc">MySQL Â· RabbitMQ é»˜è®¤å‡­æ®</div>
          </div>
        </div>
        <span class="section-badge">å»ºè®®ä¿®æ”¹</span>
      </div>
      <div class="section-body">
        <div class="section-divider"></div>
        <div class="field">
          <label for="MYSQL_ROOT_PASSWORD">MySQL root å¯†ç </label>
          <input type="text" id="MYSQL_ROOT_PASSWORD" class="monospace"
            value="password"
            placeholder="è¯·è®¾ç½®å¼ºå¯†ç "
            oninput="update()" />
          <p class="field-hint">ç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…ä¿®æ”¹ä¸ºå¼ºå¯†ç </p>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="RABBITMQ_DEFAULT_USER">RabbitMQ ç”¨æˆ·å</label>
            <input type="text" id="RABBITMQ_DEFAULT_USER" class="monospace"
              value="guest" oninput="update()" />
          </div>
          <div class="field">
            <label for="RABBITMQ_DEFAULT_PASS">RabbitMQ å¯†ç </label>
            <input type="text" id="RABBITMQ_DEFAULT_PASS" class="monospace"
              value="guest" oninput="update()" />
          </div>
        </div>
      </div>
    </div>

    <!-- 4. Mail (collapsible optional) -->
    <div class="section">
      <div class="section-header" id="hdr-mail" onclick="toggleSection('mail')">
        <div class="section-title">
          <div class="section-icon">ğŸ“§</div>
          <div>
            <div class="section-label">é‚®ä»¶æœåŠ¡</div>
            <div class="section-desc">ç”¨äºæ³¨å†ŒéªŒè¯ç ã€é€šçŸ¥ç­‰</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="section-badge optional">å¯é€‰</span>
          <svg class="chevron" id="chv-mail" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
        </div>
      </div>
      <div class="section-body collapsed" id="body-mail">
        <div class="section-divider"></div>
        <div class="field-row">
          <div class="field">
            <label for="MAIL_HOST">SMTP ä¸»æœº</label>
            <input type="text" id="MAIL_HOST" class="monospace" placeholder="smtp.qq.com" oninput="update()" />
          </div>
          <div class="field">
            <label for="MAIL_PORT">SMTP ç«¯å£</label>
            <input type="number" id="MAIL_PORT" value="" placeholder="465" oninput="update()" />
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="MAIL_USERNAME">é‚®ç®±è´¦å·</label>
            <input type="text" id="MAIL_USERNAME" class="monospace" placeholder="your@email.com" oninput="update()" />
          </div>
          <div class="field">
            <label for="MAIL_PASSWORD">æˆæƒç  / å¯†ç </label>
            <input type="password" id="MAIL_PASSWORD" class="monospace" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" oninput="update()" />
          </div>
        </div>
      </div>
    </div>

    <!-- 5. Qiniu OSS -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('qiniu')">
        <div class="section-title">
          <div class="section-icon">â˜ï¸</div>
          <div>
            <div class="section-label">ä¸ƒç‰›äº‘å­˜å‚¨</div>
            <div class="section-desc">å›¾ç‰‡ã€æ–‡ä»¶ä¸Šä¼ è‡³ä¸ƒç‰› OSS</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="section-badge optional">å¯é€‰</span>
          <svg class="chevron" id="chv-qiniu" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
        </div>
      </div>
      <div class="section-body collapsed" id="body-qiniu">
        <div class="section-divider"></div>
        <div class="field-row">
          <div class="field">
            <label for="QINIU_ACCESS_KEY">Access Key</label>
            <input type="text" id="QINIU_ACCESS_KEY" class="monospace" placeholder="AKâ€¦" oninput="update()" />
          </div>
          <div class="field">
            <label for="QINIU_SECRET_KEY">Secret Key</label>
            <input type="password" id="QINIU_SECRET_KEY" class="monospace" placeholder="SKâ€¦" oninput="update()" />
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="QINIU_BUCKET">Bucket åç§°</label>
            <input type="text" id="QINIU_BUCKET" class="monospace" placeholder="my-bucket" oninput="update()" />
          </div>
          <div class="field">
            <label for="QINIU_HOST">è®¿é—®åŸŸå</label>
            <input type="text" id="QINIU_HOST" class="monospace" placeholder="https://cdn.example.com" oninput="update()" />
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="QINIU_SIGN_KEY">å›è°ƒç­¾å Key</label>
            <input type="text" id="QINIU_SIGN_KEY" class="monospace" placeholder="å¯é€‰" oninput="update()" />
          </div>
          <div class="field">
            <label for="QINIU_SIGN_KEY2">å›è°ƒç­¾å Key2</label>
            <input type="text" id="QINIU_SIGN_KEY2" class="monospace" placeholder="å¯é€‰" oninput="update()" />
          </div>
        </div>
      </div>
    </div>

    <!-- 6. UniSMS -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('sms')">
        <div class="section-title">
          <div class="section-icon">ğŸ’¬</div>
          <div>
            <div class="section-label">çŸ­ä¿¡æœåŠ¡ UniSMS</div>
            <div class="section-desc">æ‰‹æœºå·éªŒè¯ç å‘é€</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="section-badge optional">å¯é€‰</span>
          <svg class="chevron" id="chv-sms" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
        </div>
      </div>
      <div class="section-body collapsed" id="body-sms">
        <div class="section-divider"></div>
        <div class="field-row">
          <div class="field">
            <label for="UNISMS_ACCESS_KEY">Access Key</label>
            <input type="text" id="UNISMS_ACCESS_KEY" class="monospace" placeholder="AKâ€¦" oninput="update()" />
          </div>
          <div class="field">
            <label for="UNISMS_SECRET_KEY">Secret Key</label>
            <input type="password" id="UNISMS_SECRET_KEY" class="monospace" placeholder="SKâ€¦" oninput="update()" />
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="UNISMS_TEMPLATE_ID">çŸ­ä¿¡æ¨¡æ¿ ID</label>
            <input type="text" id="UNISMS_TEMPLATE_ID" class="monospace" placeholder="pub_verif_ttyl" oninput="update()" />
          </div>
          <div class="field">
            <label for="UNISMS_SIGNATURE">ç­¾å</label>
            <input type="text" id="UNISMS_SIGNATURE" class="monospace" placeholder="ã€ç­¾åã€‘" oninput="update()" />
          </div>
        </div>
        <div class="field">
          <label for="UNI_SMS_WEBHOOK_SIGNATURE_SECRET">Webhook ç­¾åå¯†é’¥ <span class="opt-tag">å¯é€‰</span></label>
          <input type="text" id="UNI_SMS_WEBHOOK_SIGNATURE_SECRET" class="monospace" placeholder="" oninput="update()" />
        </div>
      </div>
    </div>

    <!-- 7. Tencent Translation -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('tencent')">
        <div class="section-title">
          <div class="section-icon">ğŸŒ</div>
          <div>
            <div class="section-label">è…¾è®¯äº‘ç¿»è¯‘</div>
            <div class="section-desc">æ¶ˆæ¯å®æ—¶ç¿»è¯‘åŠŸèƒ½</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="section-badge optional">å¯é€‰</span>
          <svg class="chevron" id="chv-tencent" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
        </div>
      </div>
      <div class="section-body collapsed" id="body-tencent">
        <div class="section-divider"></div>
        <div class="field-row">
          <div class="field">
            <label for="TENCENT_SECRET_ID">SecretId</label>
            <input type="text" id="TENCENT_SECRET_ID" class="monospace" placeholder="AKIDxxxxxxxx" oninput="update()" />
          </div>
          <div class="field">
            <label for="TENCENT_SECRET_KEY">SecretKey</label>
            <input type="password" id="TENCENT_SECRET_KEY" class="monospace" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" oninput="update()" />
          </div>
        </div>
      </div>
    </div>

    <!-- 8. AI Translation / MCP -->
    <div class="section">
      <div class="section-header" onclick="toggleSection('ai')">
        <div class="section-title">
          <div class="section-icon">ğŸ¤–</div>
          <div>
            <div class="section-label">AI ç¿»è¯‘ / MCP</div>
            <div class="section-desc">SiliconFlow ç­‰ AI æ¥å£ + MCP æœåŠ¡é‰´æƒ</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="section-badge optional">å¯é€‰</span>
          <svg class="chevron" id="chv-ai" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
        </div>
      </div>
      <div class="section-body collapsed" id="body-ai">
        <div class="section-divider"></div>
        <div class="field-row">
          <div class="field">
            <label for="RES_TRANSLATION_API_URL">API Base URL</label>
            <input type="text" id="RES_TRANSLATION_API_URL" class="monospace"
              value="https://api.siliconflow.cn/v1"
              placeholder="https://api.siliconflow.cn/v1"
              oninput="update()" />
          </div>
          <div class="field">
            <label for="RES_TRANSLATION_API_KEY">API Key</label>
            <input type="password" id="RES_TRANSLATION_API_KEY" class="monospace" placeholder="sk-â€¦" oninput="update()" />
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="RES_TRANSLATION_MODEL">æ¨¡å‹åç§°</label>
            <input type="text" id="RES_TRANSLATION_MODEL" class="monospace"
              value="Qwen/Qwen2.5-32B-Instruct"
              oninput="update()" />
          </div>
          <div class="field">
            <label for="RES_TRANSLATION_MAX_TOKENS">Max Tokens</label>
            <input type="number" id="RES_TRANSLATION_MAX_TOKENS" value="4096" min="1" oninput="update()" />
          </div>
        </div>
        <div class="field">
          <label for="MCP_ALLOWED_KEY">MCP é‰´æƒ Key <span class="opt-tag">å¯é€‰</span></label>
          <input type="text" id="MCP_ALLOWED_KEY" class="monospace" placeholder="è‡ªå®šä¹‰å¯†é’¥" oninput="update()" />
        </div>
      </div>
    </div>

    <!-- 9. Quick Start Steps -->
    <div class="section">
      <div class="section-header no-toggle">
        <div class="section-title">
          <div class="section-icon">ğŸ“‹</div>
          <div>
            <div class="section-label">å¯åŠ¨æ­¥éª¤</div>
            <div class="section-desc">å°†é…ç½®åº”ç”¨åˆ°æœåŠ¡å™¨</div>
          </div>
        </div>
      </div>
      <div class="section-body">
        <div class="section-divider"></div>
        <div class="step-list">
          <div class="step-item">
            <div class="step-num">1</div>
            <div>å°†å³ä¾§ <strong>.env å†…å®¹</strong> å¤åˆ¶ï¼Œä¿å­˜åˆ°æœåŠ¡å™¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º <code>.env</code></div>
          </div>
          <div class="step-item">
            <div class="step-num">2</div>
            <div>å¤åˆ¶å³ä¾§ <strong>å¯åŠ¨å‘½ä»¤</strong>ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ</div>
          </div>
          <div class="step-item" id="step-3-image" >
            <div class="step-num">3</div>
            <div>è®¿é—® <code id="web-url-display">http://your-ip:3000</code> æŸ¥çœ‹å‰ç«¯ç•Œé¢ï¼Œé»˜è®¤æµ‹è¯•è´¦å· <code>ikun233</code> / <code>123456</code></div>
          </div>
        </div>
        <div class="info-note" style="margin-top:4px">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨åˆå§‹åŒ–æ•°æ®åº“ï¼Œè¯·ç­‰å¾… MySQL å®Œå…¨å°±ç»ªåï¼ˆçº¦ 30 ç§’ï¼‰åç«¯æ‰ä¼šæ­£å¸¸å“åº”ã€‚
        </div>
      </div>
    </div>

  </div><!-- /form-col -->

  <!-- â”€â”€ Preview column â”€â”€ -->
  <div class="preview-col">
    <div class="preview-sticky">

      <!-- .env preview -->
      <div class="preview-card" style="flex:1;min-height:0;display:flex;flex-direction:column">
        <div class="preview-card-header">
          <div class="preview-card-title">
            <div class="preview-dot"></div>
            <span style="font-family:var(--font-mono)">.env</span>
            <span style="color:var(--fg-subtle);font-weight:400">â€” é…ç½®æ–‡ä»¶å†…å®¹</span>
          </div>
          <button class="copy-btn" id="copy-env-btn" onclick="copyEnv()">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            å¤åˆ¶
          </button>
        </div>
        <div class="code-scroll env-preview" style="flex:1">
          <pre id="env-output"></pre>
        </div>
      </div>

      <!-- Docker command -->
      <div class="preview-card">
        <div class="preview-card-header">
          <div class="preview-card-title">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
            <span>å¯åŠ¨å‘½ä»¤</span>
          </div>
          <button class="copy-btn" id="copy-cmd-btn" onclick="copyCmd()">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            å¤åˆ¶
          </button>
        </div>
        <div class="code-scroll cmd-preview">
          <pre id="cmd-output"></pre>
        </div>
      </div>

    </div>
  </div>

</div><!-- /layout -->

<!-- Mobile preview toggle -->
<div class="mobile-preview">
  <button class="mobile-toggle" onclick="toggleMobileSheet()">
    <span>æŸ¥çœ‹ç”Ÿæˆçš„ .env ä¸å¯åŠ¨å‘½ä»¤</span>
    <svg id="mobile-chv" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="transition:transform .2s"><path d="m6 9 6 6 6-6"/></svg>
  </button>
  <div class="mobile-sheet" id="mobile-sheet">
    <div style="margin-top:12px;display:flex;flex-direction:column;gap:12px">
      <div class="preview-card">
        <div class="preview-card-header">
          <div class="preview-card-title">
            <div class="preview-dot"></div>
            <span style="font-family:var(--font-mono)">.env</span>
          </div>
          <button class="copy-btn" onclick="copyEnv()">å¤åˆ¶</button>
        </div>
        <div class="code-scroll" style="max-height:220px">
          <pre id="env-output-mobile"></pre>
        </div>
      </div>
      <div class="preview-card">
        <div class="preview-card-header">
          <div class="preview-card-title">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
            <span>å¯åŠ¨å‘½ä»¤</span>
          </div>
          <button class="copy-btn" onclick="copyCmd()">å¤åˆ¶</button>
        </div>
        <div class="code-scroll" style="max-height:100px">
          <pre id="cmd-output-mobile"></pre>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // â”€â”€ State â”€â”€
  let mode = 'image'; // 'image' | 'build'

  // â”€â”€ Section toggle â”€â”€
  function toggleSection(id) {
    const body = document.getElementById('body-' + id);
    const chv  = document.getElementById('chv-' + id);
    if (!body) return;
    const isCollapsed = body.classList.contains('collapsed');
    body.classList.toggle('collapsed');
    chv.classList.toggle('open', isCollapsed);
  }

  // â”€â”€ Mode switch â”€â”€
  function setMode(m) {
    mode = m;
    const imgCard   = document.getElementById('mode-image-card');
    const buildCard = document.getElementById('mode-build-card');
    const imgBlock  = document.getElementById('field-image-block');
    const viteBlock = document.getElementById('field-vite-block');
    // Show/hide fields
    if (m === 'image') {
      imgCard.classList.add('active');
      buildCard.classList.remove('active');
      imgBlock.style.display = '';
      // hide vite fields
      ['field-vite-api','field-vite-ws','field-vite-oss'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
    } else {
      buildCard.classList.add('active');
      imgCard.classList.remove('active');
      imgBlock.style.display = 'none';
      ['field-vite-api','field-vite-ws','field-vite-oss'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = '';
      });
    }
    update();
  }

  // â”€â”€ Helpers â”€â”€
  function val(id) {
    const el = document.getElementById(id);
    return el ? el.value.trim() : '';
  }

  // â”€â”€ Generate .env content (plain text) â”€â”€
  function generateEnv() {
    const lines = [];
    const line  = (k, v) => lines.push(`${k}=${v}`);
    const optl  = (k, v) => { if (v) lines.push(`${k}=${v}`); };
    const cmmt  = (s) => lines.push(s);

    cmmt('# ============================================================');
    cmmt('# JiwuChat éƒ¨ç½²é…ç½®ï¼ˆç”±é…ç½®å™¨ç”Ÿæˆï¼‰');
    cmmt('# https://github.com/KiWi233333/jiwu-chat-core');
    cmmt('# ============================================================');
    cmmt('');

    if (mode === 'image') {
      cmmt('# ---------- é•œåƒ ----------');
      line('JIWU_CHAT_IMAGE', val('JIWU_CHAT_IMAGE') || 'ghcr.io/KiWi233333/jiwu-chat:latest');
      cmmt('');
    }

    cmmt('# ---------- Docker ä¸ç«¯å£ ----------');
    optl('DOCKER_REGISTRY', val('DOCKER_REGISTRY'));
    line('WEB_PORT',      val('WEB_PORT')      || '3000');
    line('API_HTTP_PORT', val('API_HTTP_PORT') || '9090');
    line('API_WS_PORT',   val('API_WS_PORT')   || '9091');
    cmmt('');

    if (mode === 'build') {
      cmmt('# ---------- å‰ç«¯æ„å»ºå‚æ•° ----------');
      line('VITE_API_BASE_URL',    val('VITE_API_BASE_URL')    || 'http://localhost:9090/');
      line('VITE_API_WS_BASE_URL', val('VITE_API_WS_BASE_URL') || 'ws://localhost:9091/ws');
      optl('VITE_BASE_OSS_PATH',   val('VITE_BASE_OSS_PATH'));
      cmmt('');
    }

    cmmt('# ---------- ä¸­é—´ä»¶ ----------');
    line('MYSQL_ROOT_PASSWORD',   val('MYSQL_ROOT_PASSWORD')   || 'password');
    line('RABBITMQ_DEFAULT_USER', val('RABBITMQ_DEFAULT_USER') || 'guest');
    line('RABBITMQ_DEFAULT_PASS', val('RABBITMQ_DEFAULT_PASS') || 'guest');

    // Mail
    const mailHost = val('MAIL_HOST');
    if (mailHost) {
      cmmt('');
      cmmt('# ---------- é‚®ä»¶æœåŠ¡ ----------');
      line('MAIL_HOST',     mailHost);
      optl('MAIL_PORT',     val('MAIL_PORT'));
      optl('MAIL_USERNAME', val('MAIL_USERNAME'));
      optl('MAIL_PASSWORD', val('MAIL_PASSWORD'));
    }

    // Qiniu
    const qiniuAk = val('QINIU_ACCESS_KEY');
    if (qiniuAk) {
      cmmt('');
      cmmt('# ---------- ä¸ƒç‰›äº‘å­˜å‚¨ ----------');
      line('QINIU_ACCESS_KEY', qiniuAk);
      optl('QINIU_SECRET_KEY', val('QINIU_SECRET_KEY'));
      optl('QINIU_BUCKET',     val('QINIU_BUCKET'));
      optl('QINIU_HOST',       val('QINIU_HOST'));
      optl('QINIU_SIGN_KEY',   val('QINIU_SIGN_KEY'));
      optl('QINIU_SIGN_KEY2',  val('QINIU_SIGN_KEY2'));
    }

    // UniSMS
    const smsAk = val('UNISMS_ACCESS_KEY');
    if (smsAk) {
      cmmt('');
      cmmt('# ---------- çŸ­ä¿¡ UniSMS ----------');
      line('UNISMS_ACCESS_KEY', smsAk);
      optl('UNISMS_SECRET_KEY', val('UNISMS_SECRET_KEY'));
      optl('UNISMS_TEMPLATE_ID', val('UNISMS_TEMPLATE_ID'));
      optl('UNISMS_SIGNATURE',   val('UNISMS_SIGNATURE'));
      optl('UNI_SMS_WEBHOOK_SIGNATURE_SECRET', val('UNI_SMS_WEBHOOK_SIGNATURE_SECRET'));
    }

    // Tencent
    const tencentId = val('TENCENT_SECRET_ID');
    if (tencentId) {
      cmmt('');
      cmmt('# ---------- è…¾è®¯äº‘ç¿»è¯‘ ----------');
      line('TENCENT_SECRET_ID',  tencentId);
      optl('TENCENT_SECRET_KEY', val('TENCENT_SECRET_KEY'));
    }

    // AI Translation / MCP
    const aiKey = val('RES_TRANSLATION_API_KEY');
    const mcpKey = val('MCP_ALLOWED_KEY');
    if (aiKey || mcpKey) {
      cmmt('');
      cmmt('# ---------- AI ç¿»è¯‘ / MCP ----------');
      optl('RES_TRANSLATION_API_URL',    val('RES_TRANSLATION_API_URL'));
      optl('RES_TRANSLATION_API_KEY',    aiKey);
      optl('RES_TRANSLATION_MODEL',      val('RES_TRANSLATION_MODEL'));
      optl('RES_TRANSLATION_MAX_TOKENS', val('RES_TRANSLATION_MAX_TOKENS'));
      optl('MCP_ALLOWED_KEY',            mcpKey);
    }

    return lines.join('\n');
  }

  // â”€â”€ Generate docker command â”€â”€
  function generateCmd() {
    if (mode === 'image') {
      return 'docker compose up -d';
    } else {
      return 'docker compose up -d --build';
    }
  }

  // â”€â”€ Syntax highlight for .env â”€â”€
  function highlight(text) {
    return text
      .split('\n')
      .map(line => {
        if (line.startsWith('#')) {
          return `<span class="tk-comment">${esc(line)}</span>`;
        }
        if (line === '') return '';
        const eqIdx = line.indexOf('=');
        if (eqIdx === -1) return esc(line);
        const key = line.slice(0, eqIdx);
        const v   = line.slice(eqIdx + 1);
        const valSpan = v === ''
          ? `<span class="tk-empty">''</span>`
          : `<span class="tk-val">${esc(v)}</span>`;
        return `<span class="tk-key">${esc(key)}</span><span class="tk-eq">=</span>${valSpan}`;
      })
      .join('\n');
  }

  function highlightCmd(text) {
    return text
      .split('\n')
      .map(line => {
        // colorize flags and subcommands
        return line
          .replace(/^(docker|compose|docker compose)/g, '<span class="tk-cmd">$1</span>')
          .replace(/(--\w[\w-]*)/g, '<span class="tk-flag">$1</span>')
          .replace(/(-\w)/g, '<span class="tk-flag">$1</span>');
      })
      .join('\n');
  }

  function esc(s) {
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  }

  // â”€â”€ Update preview â”€â”€
  function update() {
    const envText = generateEnv();
    const cmdText = generateCmd();

    // Desktop
    const envEl = document.getElementById('env-output');
    const cmdEl = document.getElementById('cmd-output');
    if (envEl) envEl.innerHTML = highlight(envText);
    if (cmdEl) cmdEl.innerHTML = highlightCmd(cmdText);

    // Mobile
    const envM = document.getElementById('env-output-mobile');
    const cmdM = document.getElementById('cmd-output-mobile');
    if (envM) envM.innerHTML = highlight(envText);
    if (cmdM) cmdM.innerHTML = highlightCmd(cmdText);

    // Update web URL display
    const portEl = document.getElementById('web-url-display');
    const webPort = val('WEB_PORT') || '3000';
    if (portEl) portEl.textContent = `http://your-ip:${webPort}`;
  }

  // â”€â”€ Copy to clipboard â”€â”€
  async function copyText(text, btnId) {
    try {
      await navigator.clipboard.writeText(text);
      const btn = document.getElementById(btnId);
      if (btn) {
        btn.classList.add('copied');
        btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> å·²å¤åˆ¶`;
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> å¤åˆ¶`;
        }, 2000);
      }
    } catch(e) {
      // fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.opacity = '0';
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
    }
  }

  function copyEnv() { copyText(generateEnv(), 'copy-env-btn'); }
  function copyCmd() { copyText(generateCmd(), 'copy-cmd-btn'); }

  // â”€â”€ Mobile sheet â”€â”€
  function toggleMobileSheet() {
    const sheet = document.getElementById('mobile-sheet');
    const chv = document.getElementById('mobile-chv');
    const isOpen = sheet.classList.contains('open');
    sheet.classList.toggle('open', !isOpen);
    chv.style.transform = isOpen ? '' : 'rotate(180deg)';
  }

  // â”€â”€ Init â”€â”€
  setMode('image');
  update();
</script>
</body>
</html>
